<!DOCTYPE html>
<html lang="{{ .Language }}">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script>
            const config = new Map([
                ["labelTaskHeader",  "{{ .I18n.LabelTaskHeader }}"],
                ["labelTaskType", "{{ .I18n.LabelTaskType }}"],
                ["labelTaskTypeSingle", "{{ .I18n.LabelTaskTypeSingle }}"],
                ["labelTaskTypeMultiple", "{{ .I18n.LabelTaskTypeMultiple }}"],
                ["labelTaskTypeOpen", "{{ .I18n.LabelTaskTypeOpen }}"],
                ["labelTaskTypeFile", "{{ .I18n.LabelTaskTypeFile }}"],
                ["labelTaskText", "{{ .I18n.LabelTaskText }}"],
                ["labelTaskAnswer", "{{ .I18n.LabelTaskAnswer }}"],
                ["labelTaskOptions", "{{ .I18n.LabelTaskOptions }}"],
                ["labelTaskAddOption", "{{ .I18n.LabelTaskAddOption }}"],
                ["labelAddAttachment", "{{ .I18n.LabelAddAttachment }}"],
                ["labelAttachmentType", "{{ .I18n.LabelAttachmentType }}"],
                ["labelAttachmentTypeFile", "{{ .I18n.LabelAttachmentTypeFile }}"],
                ["labelAttachmentTypeImage", "{{ .I18n.LabelAttachmentTypeImage }}"],
                ["labelAttachmentTypeVideo", "{{ .I18n.LabelAttachmentTypeVideo }}"],
                ["labelAttachmentTypeAudio", "{{ .I18n.LabelAttachmentTypeAudio }}"],
                ["labelAttachmentName", "{{ .I18n.LabelAttachmentName }}"],
                ["labelAttachmentSrc", "{{ .I18n.LabelAttachmentSrc }}"],
            ])
        </script>
        <link rel="stylesheet" href="/static/css/fonts.css">
        <link rel="stylesheet" href="/static/css/common.css">
        <link rel="stylesheet" href="/static/css/editor.css">
        <link rel="stylesheet" href="/static/css/form.css">
        <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
        <link rel="shortcut icon" type="image/x-icon" href="/static/img/favicon.ico">
        <title>{{ .I18n.Header }}</title>
    </head>
    <body>
        <header class="header">
            <h1 class="main-header">
                {{ .I18n.Header }}
            </h1>
        </header>
        <main class="main">
            <form
                class="form"
                action="/editor/create"
                method="POST"
                enctype="multipart/form-data"
            >
                <div class="input-wrapper">
                    <label for="title">
                        {{ .I18n.LabelTitle }}
                    </label>
                    <input
                        id="title"
                        class="input-text"
                        name="title"
                        type="text"
                        value="{{ .Test.Title }}"
                    >
                </div>
                <div class="input-wrapper">
                    <label for="description">
                        {{ .I18n.LabelDescription }}
                    </label>
                    <textarea
                        id="description"
                        class="input-text"
                        name="description"
                        type="text"
                    >{{ .Test.Description }}</textarea>
                </div>
                <div class="input-wrapper">
                    <label for="subject">
                        {{ .I18n.LabelSubject }}
                    </label>
                    <input
                        id="subject"
                        class="input-text"
                        name="subject"
                        type="text"
                        value="{{ .Test.Subject }}"
                    >
                </div>
                <div class="input-wrapper">
                    <label for="author">
                        {{ .I18n.LabelAuthor }}
                    </label>
                    <input
                        id="author"
                        class="input-text"
                        name="author"
                        type="text"
                        value="{{ .Test.Author }}"
                    >
                </div>
                <div class="input-wrapper">
                    <label for="target">
                        {{ .I18n.LabelTarget }}
                    </label>
                    <input
                        id="target"
                        class="input-text"
                        name="target"
                        type="text"
                        value="{{ .Test.Target }}"
                    >
                </div>
                <div class="input-wrapper">
                    <label for="institution">
                        {{ .I18n.LabelInstitution }}
                    </label>
                    <input
                        id="institution"
                        class="input-text"
                        name="institution"
                        type="text"
                        value="{{ .Test.Institution }}"
                    >
                </div>
                <div class="input-wrapper">
                    <label for="expiresIn">
                        {{ .I18n.LabelExpiresIn }}
                    </label>
                    <input
                        id="expiresIn"
                        class="input-datetime"
                        name="expiresIn"
                        type="datetime-local"
                        value="{{ if not .Test.ExpiresIn.IsZero }}{{ .Test.ExpiresIn.Format "2006-01-02T15:04:05" }}{{ end }}"
                    >
                </div>
                
                <input
                    id="number-of-tasks-input"
                    name="number-of-tasks"
                    type="hidden"
                    value="{{ len .Test.Tasks }}"
                >

                <section class="tasks" id="tasks">
                    {{ range $taskIndex, $task := .Test.Tasks }}
                        <fieldset class="test-task task-{{ $taskIndex }}">
                            <legend>{{ $.I18n.LabelTaskHeader }} {{ call $.incr $taskIndex }}</legend>
                            <div class="input-wrapper">
                                <label for="{{ $taskIndex }}-type">
                                    {{ $.I18n.LabelTaskType }}
                                </label>
                                <select
                                    id="{{ $taskIndex }}-type"
                                    class="input-select"
                                    name="{{ $taskIndex }}-type"
                                >
                                    {{ if eq $task.Type "single" }}
                                        <option selected value="single">
                                            {{ $.I18n.LabelTaskTypeSingle }}
                                        </option>
                                    {{ else }}
                                        <option value="single">
                                            {{ $.I18n.LabelTaskTypeSingle }}
                                        </option>
                                    {{ end }}
                                    {{ if eq $task.Type "multiple" }}
                                        <option selected value="multiple">
                                            {{ $.I18n.LabelTaskTypeMultiple }}
                                        </option>
                                    {{ else }}
                                        <option value="multiple">
                                            {{ $.I18n.LabelTaskTypeMultiple }}
                                        </option>
                                    {{ end }}
                                    {{ if eq $task.Type "open" }}
                                        <option selected value="open">
                                            {{ $.I18n.LabelTaskTypeOpen }}
                                        </option>
                                    {{ else }}
                                        <option value="open">
                                            {{ $.I18n.LabelTaskTypeOpen }}
                                        </option>
                                    {{ end }}
                                    {{ if eq $task.Type "file" }}
                                        <option selected value="file">
                                            {{ $.I18n.LabelTaskTypeFile }}
                                        </option>
                                    {{ else }}
                                        <option value="file">
                                            {{ $.I18n.LabelTaskTypeFile }}
                                        </option>
                                    {{ end }}
                                </select>
                            </div>
                            <div class="input-wrapper">
                                <label for="{{ $taskIndex }}-text">
                                    {{ $.I18n.LabelTaskText }}
                                </label>
                                <textarea
                                    id="{{ $taskIndex }}-text"
                                    class="input-text"
                                    name="{{ $taskIndex }}-text"
                                >{{ $task.Text }}</textarea>
                            </div>
                            <div class="input-wrapper">
                                <label for="{{ $taskIndex }}-answer">
                                    {{ $.I18n.LabelTaskAnswer }}
                                </label>
                                <input
                                    id="{{ $taskIndex }}-answer"
                                    class="input-text"
                                    type="text"
                                    name="{{ $taskIndex }}-answer"
                                    value="{{ $task.Answer }}"
                                >
                            </div>

                            <div class="answer-options-wrapper">
                                <p>{{ $.I18n.LabelTaskOptions }}</p>
                                <div class="answer-options" id="{{ $taskIndex }}-options">
                                    {{ range $optionIndex, $option := $task.Options }}
                                        <div class="input-wrapper">
                                            <label for="{{ $taskIndex }}-option-{{ $optionIndex }}">
                                                {{ call $.incr $optionIndex }})
                                            </label>
                                            <input
                                                id="{{ $taskIndex }}-option-{{ $optionIndex }}"
                                                class="input-text"
                                                name="{{ $taskIndex }}-options"
                                                value="{{ . }}"
                                            >
                                        </div>
                                    {{ end }}
                                </div>
                                <button
                                    class="button-add-option"
                                    type="button"
                                    onclick="addOption({{ $taskIndex }})"
                                >
                                    {{ $.I18n.LabelTaskAddOption }}
                                </button>
                            </div>

                            {{ $hasAttachment := ne $task.Attachment.Type "" }}
                            <div class="attachment-wrapper">
                                <div>
                                    <input
                                        id="{{ $taskIndex }}-has-attachment"
                                        class="input-checkbox"
                                        type="checkbox"
                                        name="{{ $taskIndex }}-has-attachment"
                                        onchange="toggleAttachment({{ $taskIndex }}, this)"
                                        checked="{{ $hasAttachment }}"
                                    >
                                    <label for="{{ $taskIndex }}-has-attachment">
                                        {{ $.I18n.LabelAddAttachment }}
                                    </label>
                                </div>
                                <div
                                    id="{{ $taskIndex }}-attachment"
                                    class="attachment"
                                    data-enabled="{{ $hasAttachment }}"
                                >
                                    {{ if $hasAttachment }}
                                        <div class="input-wrapper">
                                            <label for="{{ $taskIndex }}-attachment-name">
                                                {{ $.I18n.LabelAttachmentName }}
                                            </label>
                                            <input
                                                id="{{ $taskIndex }}-attachment-name"
                                                class="input-text"
                                                type="text"
                                                name="{{ $taskIndex }}-attachment-name"
                                                value="{{ $task.Attachment.Name }}"
                                            >
                                        </div>
                                        <div class="input-wrapper">
                                            <label for="{{ $taskIndex }}-attachment-type">
                                                {{ $.I18n.LabelAttachmentType }}
                                            </label>
                                            <select
                                                id="{{ $taskIndex }}-attachment-type"
                                                class="input-select"
                                                name="{{ $taskIndex }}-attachment-type"
                                                value="{{ $task.Attachment.Type }}"
                                            >
                                                {{ if eq $task.Attachment.Type "file" }}
                                                    <option selected value="file">
                                                        {{ $.I18n.LabelAttachmentTypeFile }}
                                                    </option>
                                                {{ else }}
                                                    <option value="file">
                                                        {{ $.I18n.LabelAttachmentTypeFile }}
                                                    </option>
                                                {{ end }}
                                                {{ if eq $task.Attachment.Type "image" }}
                                                    <option selected value="image">
                                                        {{ $.I18n.LabelAttachmentTypeImage }}
                                                    </option>
                                                {{ else }}
                                                    <option value="image">
                                                        {{ $.I18n.LabelAttachmentTypeImage }}
                                                    </option>
                                                {{ end }}
                                                {{ if eq $task.Attachment.Type "video" }}
                                                    <option selected value="video">
                                                        {{ $.I18n.LabelAttachmentTypeVideo }}
                                                    </option>
                                                {{ else }}
                                                    <option value="video">
                                                        {{ $.I18n.LabelAttachmentTypeVideo }}
                                                    </option>
                                                {{ end }}
                                                {{ if eq $task.Attachment.Type "audio" }}
                                                    <option selected value="audio">
                                                        {{ $.I18n.LabelAttachmentTypeAudio }}
                                                    </option>
                                                {{ else }}
                                                    <option value="audio">
                                                        {{ $.I18n.LabelAttachmentTypeAudio }}
                                                    </option>
                                                {{ end }}
                                            </select>
                                        </div>
                                        <div class="input-wrapper">
                                            <label for="{{ $taskIndex }}-attachment-src">
                                                {{ $.I18n.LabelAttachmentSrc }}
                                            </label>
                                            <input
                                                id="{{ $taskIndex }}-attachment-src"
                                                class="input-text"
                                                type="text"
                                                name="{{ $taskIndex }}-attachment-src"
                                                value="{{ $task.Attachment.Src }}"
                                            >
                                        </div>
                                    {{ end }}
                                </div>
                            </div>
                        </fieldset>
                    {{ end }}
                </section>

                <button
                    id="button-add-task"
                    class="button-add-task"
                    type="button"
                >
                    {{ .I18n.LabelAddTask }}
                </button>

                <button class="button" type="submit">
                    {{ .I18n.LabelDownloadTest }}
                </button>
            </form>
        </main>
        <script src="/static/js/editor.js"></script>
    </body>
</html>
